# üìä ETL –°–∏—Å—Ç–µ–º–∞ - –ü–æ–ª–Ω–∞—è —Å–≤–æ–¥–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

## ‚úÖ –ß—Ç–æ –≥–æ—Ç–æ–≤–æ

### üóÑÔ∏è –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (3 –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ë–î)

1. **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ë–î (PostgreSQL)** - `etl_metadata`
   - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞–π–ø–ª–∞–π–Ω–∞—Ö –∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞—Ö –¥–∞–Ω–Ω—ã—Ö
   - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ –∏ –∞—É–¥–∏—Ç
   - –ü–æ—Ä—Ç: `5432`

2. **–†–∞–±–æ—á–∞—è –ë–î (PostgreSQL)** - `etl_staging`  
   - –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∞–π–ª–æ–≤/–≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
   - –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏
   - –ü–æ—Ä—Ç: `5433`

3. **–¶–µ–ª–µ–≤–∞—è –ë–î (ClickHouse)** - `etl_target`
   - –§–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã ETL
   - –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö
   - –ë–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞
   - –ü–æ—Ä—Ç: `8123`

### üìã SQLAlchemy –º–æ–¥–µ–ª–∏

#### –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ë–î:
- `DataSource` - –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- `Pipeline` - –ø–∞–π–ø–ª–∞–π–Ω—ã ETL
- `PipelineRun` - –∑–∞–ø—É—Å–∫–∏ –ø–∞–π–ø–ª–∞–π–Ω–æ–≤
- `AnalysisResult` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ ML

#### –†–∞–±–æ—á–∞—è –ë–î:
- `StagingTable` - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è —Å—Ç–∞–¥–∏—Ä–æ–≤–∞–Ω–∏—è
- `FileMetadata` - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- `ProcessingLog` - –ª–æ–≥–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö

#### –¶–µ–ª–µ–≤–∞—è –ë–î:
- `DataQualityMetrics` - –º–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö
- `BusinessMetrics` - –±–∏–∑–Ω–µ—Å –º–µ—Ç—Ä–∏–∫–∏ –∏ KPI
- `DataLineage` - –ª–∏–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (–æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à–ª–∏ –¥–∞–Ω–Ω—ã–µ)
- `DataCatalog` - –∫–∞—Ç–∞–ª–æ–≥ –¥–∞–Ω–Ω—ã—Ö
- `ETLAuditLog` - –∞—É–¥–∏—Ç –ª–æ–≥ ETL –æ–ø–µ—Ä–∞—Ü–∏–π

### üîÑ –ú–∏–≥—Ä–∞—Ü–∏–∏ Alembic

- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ë–î
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic –¥–ª—è —Ä–∞–±–æ—á–µ–π –ë–î  
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü —Ä–∞–±–æ—á–µ–π –ë–î
- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ClickHouse (–∫–æ–ª–æ–Ω–æ—á–Ω–∞—è –ë–î)

### üê≥ Docker Compose

- ‚úÖ –¢—Ä–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö PostgreSQL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- ‚úÖ ClickHouse –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
- ‚úÖ Health checks –¥–ª—è –≤—Å–µ—Ö –ë–î
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ—Ä—Ç—ã –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ Volumes –¥–ª—è –¥–∞–Ω–Ω—ã—Ö

### üõ†Ô∏è –£—Ç–∏–ª–∏—Ç—ã –∏ —Å–∫—Ä–∏–ø—Ç—ã

#### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:
- ‚úÖ `scripts/setup.sh` - –ø–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- ‚úÖ `scripts/migrate.py` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
- ‚úÖ `scripts/init_clickhouse.py` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ClickHouse
- ‚úÖ `scripts/db_cli.py` - CLI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ë–î

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
- ‚úÖ `app/core/config.py` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ç—Ä–µ—Ö –ë–î
- ‚úÖ `app/connectors/database_manager.py` - –º–µ–Ω–µ–¥–∂–µ—Ä –ë–î
- ‚úÖ `env.example` - –ø—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

#### –ü—Ä–∏–º–µ—Ä—ã:
- ‚úÖ `examples/quick_start.py` - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏

### üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- ‚úÖ `README_ETL_DATABASE.md` - –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (577 —Å—Ç—Ä–æ–∫)
- ‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –∏ –∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- ‚úÖ –ü—Ä–∏–º–µ—Ä—ã SQL –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é
- ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –ø–∞–π–ø–ª–∞–π–Ω–∞—Ö

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫:
```bash
cd backend
./scripts/setup.sh
```

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫:
```bash
# 1. –ó–∞–ø—É—Å–∫ –ë–î
docker-compose up -d metadata-postgres staging-postgres target-clickhouse

# 2. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
python scripts/migrate.py all upgrade head

# 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ClickHouse
python scripts/init_clickhouse.py

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞
python scripts/db_cli.py test
```

## üìä –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ë–î:
```bash
python scripts/db_cli.py test          # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
python scripts/db_cli.py stats         # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ë–î
python scripts/db_cli.py tables        # –°–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü
python scripts/db_cli.py runs          # –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø—É—Å–∫–∏ –ø–∞–π–ø–ª–∞–π–Ω–æ–≤
python scripts/db_cli.py quality       # –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö
python scripts/db_cli.py cleanup       # –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
python scripts/db_cli.py backup        # –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞
```

### –ú–∏–≥—Ä–∞—Ü–∏–∏:
```bash
python scripts/migrate.py metadata upgrade head    # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ë–î
python scripts/migrate.py staging upgrade head     # –†–∞–±–æ—á–∞—è –ë–î
python scripts/migrate.py all upgrade head         # –í—Å–µ –ë–î
```

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:
```bash
python examples/quick_start.py         # –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```

## üîó –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

### –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ë–î:
```
Host: localhost:5432
Database: etl_metadata
User: metadata_user
Password: metadata_password
```

### –†–∞–±–æ—á–∞—è –ë–î:
```
Host: localhost:5433
Database: etl_staging  
User: staging_user
Password: staging_password
```

### ClickHouse:
```
Host: localhost:8123
Database: etl_target
User: default
Password: (–ø—É—Å—Ç–æ–π)
```

## üìà –ß—Ç–æ –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å

1. **–°–æ–∑–¥–∞–≤–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö** - —Ñ–∞–π–ª—ã, –ë–î, API, Kafka
2. **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–∞–π–ø–ª–∞–π–Ω—ã** - —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π, —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è–º–∏, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º
3. **–ó–∞–ø—É—Å–∫–∞—Ç—å ETL –ø—Ä–æ—Ü–µ—Å—Å—ã** - —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
4. **–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö** - –º–µ—Ç—Ä–∏–∫–∏, –∞–ª–µ—Ä—Ç—ã, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
5. **–û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏** - KPI, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
6. **–í–µ—Å—Ç–∏ –∞—É–¥–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏–π** - –∫—Ç–æ, —á—Ç–æ, –∫–æ–≥–¥–∞ –¥–µ–ª–∞–ª
7. **–£–ø—Ä–∞–≤–ª—è—Ç—å –∫–∞—Ç–∞–ª–æ–≥–æ–º –¥–∞–Ω–Ω—ã—Ö** - –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –∏ —Å—Ç–æ–ª–±—Ü–æ–≤
8. **–û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ª–∏–Ω–∏—é –¥–∞–Ω–Ω—ã—Ö** - –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à–ª–∏ –¥–∞–Ω–Ω—ã–µ

## üéØ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ. –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–æ–∑–¥–∞–Ω—ã, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã. –ú–æ–∂–Ω–æ —Å—Ä–∞–∑—É –Ω–∞—á–∏–Ω–∞—Ç—å —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–∞–π–ø–ª–∞–π–Ω—ã –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ.

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –∫–æ–º–∞–Ω–¥–æ–π `./scripts/setup.sh`
2. –ò–∑—É—á–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ `README_ETL_DATABASE.md`
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: `python examples/quick_start.py`
4. –°–æ–∑–¥–∞—Ç—å —Å–≤–æ–∏ –ø–∞–π–ø–ª–∞–π–Ω—ã —á–µ—Ä–µ–∑ API –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é –≤ –ë–î

**üéâ –ü—Ä–æ–µ–∫—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!**
